<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Detective Archives</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Special+Elite&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              'display': ['Special Elite', 'monospace'],
              'body': ['Roboto', 'sans-serif'],
            },
            colors: {
              'noir-bg': '#1a1a1a',
              'noir-paper': '#f3e9d2',
              'noir-text': '#3d3d3d',
              'noir-accent': '#c6a800',
              'noir-red': '#a03232',
              'noir-green': '#4a7856',
            }
          }
        }
      }
    </script>
    <style>
      body {
        background-color: #1a1a1a;
        margin: 0;
        font-family: 'Roboto', sans-serif;
      }
      /* Custom Scrollbar */
      ::-webkit-scrollbar {
        width: 10px;
      }
      ::-webkit-scrollbar-track {
        background: #1a1a1a; 
      }
      ::-webkit-scrollbar-thumb {
        background: #c6a800; 
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #a08900; 
      }
      .custom-scrollbar::-webkit-scrollbar-thumb {
          background-color: #3d3d3d;
      }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
<body>
    <div id="root"></div>

    <!-- React Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel Standalone for JSX compilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo } = React;

        // --- CONSTANTS ---
        const TOTAL_TIME = 480; // 8 minutes TOTAL for both cases
        const TOTAL_LIVES = 3;

        const TRANSLATIONS = {
          en: {
              title: "Detective Archives",
              start_button: "Start Investigation",
              lives: "Lives",
              time: "Time",
              level: "Level",
              reading_strategy: "Reading Strategy",
              toggle_language: "Toggle Language üá¨üáß/üá™üá∏",
              correct: "Correct!",
              incorrect: "Incorrect!",
              next_level: "Next Clue",
              case_closed_win: "Case Closed!",
              case_closed_lose: "END OF THE LINE...",
              win_message: "Congratulations, Detective! You've solved the case.",
              lose_message_time: "Time ran out. The trail went cold.",
              lose_message_lives: "Your badge feels heavy, a useless piece of tin. You took too many wrong turns.",
              play_again: "Next Case",
              correct_answer_was: "The correct information was:",
              all_cases_solved: "All Cases Solved",
              final_message: "Excellent work, Detective. You've closed all available cases. The city is safe, for now.",
              return_to_start: "Play Again",
              finish_investigation: "Finish Investigation",
              manual_title: "Operations Manual",
              accept_mission: "I Accept The Mission"
          },
          es: {
              title: "Archivos de Detective",
              start_button: "Iniciar Investigaci√≥n",
              lives: "Vidas",
              time: "Tiempo",
              level: "Nivel",
              reading_strategy: "Estrategia de Lectura",
              toggle_language: "Cambiar Idioma üá¨üáß/üá™üá∏",
              correct: "¬°Correcto!",
              incorrect: "¬°Incorrecto!",
              next_level: "Siguiente Pista",
              case_closed_win: "¬°Caso Cerrado!",
              case_closed_lose: "FIN DEL CAMINO...",
              win_message: "¬°Felicidades, Detective! Has resuelto el caso.",
              lose_message_time: "Se acab√≥ el tiempo. La pista se enfri√≥.",
              lose_message_lives: "Tu placa se siente pesada, un in√∫til trozo de metal. Tomaste demasiados desv√≠os.",
              play_again: "Siguiente Caso",
              correct_answer_was: "La informaci√≥n correcta era:",
              all_cases_solved: "Todos los Casos Resueltos",
              final_message: "Excelente trabajo, Detective. Ha cerrado todos los casos disponibles. La ciudad est√° a salvo, por ahora.",
              return_to_start: "Jugar de Nuevo",
              finish_investigation: "Finalizar Investigaci√≥n",
              manual_title: "Manual de Operaciones",
              accept_mission: "Acepto la Misi√≥n"
          }
        };

        const CASES = [
          {
            title: { en: "The Midnight Heist", es: "El Robo de Medianoche" },
            imageUrl: "inicio.png",
            levels: [
              {
                id: 1,
                strategy: { en: "Predicting", es: "Predicci√≥n" },
                evidence: {
                  type: 'image_title',
                  title: { en: "Case File: 001", es: "Expediente: 001" },
                  content: 'Chaos at the National Bank',
                  imageUrl: "caos en el banco.png"
                },
                instruction: { en: "Look at the evidence and the title.", es: "Mira la evidencia y el t√≠tulo." },
                question: { en: "What do you think this report will be about?", es: "¬øDe qu√© crees que tratar√° este informe?" },
                options: [
                  { en: "A robbery", es: "Un robo" },
                  { en: "A party", es: "Una fiesta" },
                  { en: "An election", es: "Una elecci√≥n" }
                ],
                correctAnswerIndex: 0
              },
              {
                id: 2,
                strategy: { en: "Skimming", es: "Lectura R√°pida (Skimming)" },
                evidence: {
                  type: 'text',
                  title: { en: "Newspaper Clipping", es: "Recorte de Peri√≥dico" },
                  content: [
                    "The city awoke this morning to the shocking news of a daring heist at the historic National Bank, which occurred under the cover of darkness late last night. The brazen act has left officials and citizens in disbelief, as the institution was considered a fortress. Authorities from the metropolitan police department are now scrambling for any credible leads after the main vault, containing an undisclosed amount of assets, was discovered completely emptied by the morning staff.",
                    "Initial reports from the crime scene suggest a highly sophisticated operation, executed with chilling precision. The bank's security systems, which were upgraded last year and considered state-of-the-art, were bypassed without triggering a single audible or silent alarm. Forensics teams are meticulously examining the vault for any trace evidence, but the perpetrators appear to have been exceptionally careful, leaving little behind for investigators to work with.",
                    "A statement from Police Chief Miller confirmed that there are no suspects at this time, though he assured the public that every resource is being dedicated to the investigation. He mentioned the thief, or thieves, displayed an 'intimate knowledge' of the bank's layout and security protocols. This suggests the possibility of an inside job, a theory that is causing considerable unease among the bank's board of directors and high-profile clients.",
                    "The economic impact of the heist is still being calculated, but experts fear it could be substantial. The National Bank holds assets for many of the city's most powerful corporations and individuals. The police have not released a statement on the value of the stolen assets, but sources inside the investigation hint that the figure is staggering. They are appealing to the public for any information regarding suspicious activity around the bank in the days leading up to the event."
                  ]
                },
                instruction: { en: "Quickly read the first sentence of each paragraph.", es: "Lee r√°pidamente la primera oraci√≥n de cada p√°rrafo." },
                question: { en: "What is the general idea of the article?", es: "¬øCu√°l es la idea general del art√≠culo?" },
                options: [
                  { en: "A sophisticated robbery has occurred at the National Bank, and the police are investigating.", es: "Ocurri√≥ un robo sofisticado en el Banco Nacional y la polic√≠a est√° investigando." },
                  { en: "The bank is celebrating its anniversary with a large public event.", es: "El banco est√° celebrando su aniversario con un gran evento p√∫blico." },
                  { en: "Police Chief Miller is retiring after a long and successful career.", es: "El jefe de polic√≠a Miller se retira despu√©s de una larga y exitosa carrera." }
                ],
                correctAnswerIndex: 0
              },
              {
                id: 3,
                strategy: { en: "Scanning", es: "B√∫squeda de Datos (Scanning)" },
                evidence: {
                  type: 'data_sheet',
                  title: { en: "Suspect Profiles", es: "Perfiles de Sospechosos" },
                  content: [
                    { "ID": "Suspect #1", "Name": "Silas 'The Shadow' Blackwood", "Age": "42", "Height": "6'1\"", "Occupation": "Antiques Dealer", "Alibi": "At the opera" },
                    { "ID": "Suspect #2", "Name": "Isabella 'The Ghost' Monet", "Age": "35", "Height": "5'7\"", "Occupation": "Art Forger", "Alibi": "Charity gala" },
                    { "ID": "Suspect #3", "Name": "Leo 'The Lock' Vance", "Age": "51", "Height": "5'11\"", "Occupation": "Retired Safecracker", "Alibi": "Home with family" },
                    { "ID": "Suspect #4", "Name": "Marcus 'The Mole' Thorne", "Age": "48", "Height": "5'9\"", "Occupation": "Bank Security Consultant", "Alibi": "Out of town" },
                    { "ID": "Suspect #5", "Name": "Eve 'The Viper' Rostova", "Age": "39", "Height": "5'5\"", "Occupation": "Corporate Espionage", "Alibi": "Unknown" }
                  ]
                },
                instruction: { en: "Quickly find the specific information requested.", es: "Encuentra r√°pidamente la informaci√≥n espec√≠fica solicitada." },
                question: { en: "Find the height of Suspect #2.", es: "Encuentra la altura del Sospechoso #2." },
                options: [
                  { en: "6'1\"", es: "6'1\"" },
                  { en: "5'7\"", es: "5'7\"" },
                  { en: "5'9\"", es: "5'9\"" }
                ],
                correctAnswerIndex: 1
              },
              {
                id: 4,
                strategy: { en: "Contextual Guessing", es: "Adivinanza Contextual" },
                evidence: {
                  type: 'sms',
                  title: { en: "Intercepted Transmission", es: "Transmisi√≥n Interceptada" },
                  content: "Transcript from informant call: 'Yeah, I saw him... or, I think I saw him. He moved like a shadow, in and out of the alley before you could blink. We had officers swarming the block, but the thief was just too elusive. It's like he vanished into thin air; nobody could get a positive ID or even track his direction.'"
                },
                instruction: { en: "Use the surrounding words to understand the highlighted word.", es: "Usa las palabras de alrededor para entender la palabra resaltada." },
                question: { en: "Based on the context, what does 'elusive' mean?", es: "Basado en el contexto, ¬øqu√© significa 'elusive'?" },
                options: [
                  { en: "Hard to find or catch", es: "Dif√≠cil de encontrar o atrapar" },
                  { en: "Very fast", es: "Muy r√°pido" },
                  { en: "Visibly angry", es: "Visiblemente enojado" }
                ],
                correctAnswerIndex: 0
              },
              {
                id: 5,
                strategy: { en: "Intensive Reading", es: "Lectura Intensiva" },
                evidence: {
                  type: 'legal_text',
                  title: { en: "Vault Access Log - Excerpt", es: "Registro de Acceso a B√≥veda - Extracto" },
                  content: "As per section 4B of the security agreement, the Senior Vault Manager, currently Mr. Abernathy, is the sole party responsible for the vault's contents during closing hours. A review of the access log shows his digital signature was the last one recorded. He confirmed during his initial statement that the closing protocol, which he himself designed, was followed to the letter."
                },
                instruction: { en: "Analyze the sentence structure and grammar carefully.", es: "Analiza la estructura de la oraci√≥n y la gram√°tica cuidadosamente." },
                question: { en: "In the final sentence, who does the pronoun 'He' refer to?", es: "En la oraci√≥n final, ¬øa qui√©n se refiere el pronombre 'He' (√âl)?" },
                options: [
                  { en: "A police officer", es: "Un oficial de polic√≠a" },
                  { en: "The security agreement", es: "El acuerdo de seguridad" },
                  { en: "Mr. Abernathy", es: "Sr. Abernathy" }
                ],
                correctAnswerIndex: 2
              },
              {
                id: 6,
                strategy: { en: "Inferring", es: "Inferencia" },
                evidence: {
                  type: 'note',
                  title: { en: "Note from the Thief", es: "Nota del Ladr√≥n" },
                  content: "The marble halls of this institution were built on the broken backs of the working man. For too long, you have hoarded wealth while the city starves. Consider this not a theft, but a redistribution. I have simply taken back what truly belongs to the people."
                },
                instruction: { en: "Read between the lines. What is the hidden meaning?", es: "Lee entre l√≠neas. ¬øCu√°l es el significado oculto?" },
                question: { en: "What is the thief's likely motivation?", es: "¬øCu√°l es la motivaci√≥n probable del ladr√≥n?" },
                options: [
                  { en: "A political or social grievance against the bank", es: "Una queja pol√≠tica o social contra el banco" },
                  { en: "Simple greed for personal wealth", es: "Simple codicia por riqueza personal" },
                  { en: "A personal vendetta against an employee", es: "Una venganza personal contra un empleado" }
                ],
                correctAnswerIndex: 0
              },
              {
                id: 7,
                strategy: { en: "Extensive Reading", es: "Lectura Extensiva" },
                evidence: {
                  type: 'narrative',
                  title: { en: "Bank Founder's Diary", es: "Diario del Fundador del Banco" },
                  content: "The National Bank wasn't always a symbol of cold, hard wealth. It was founded a century ago by a group of immigrants, laborers and shopkeepers who pooled their meager savings to build a better future for their families. They envisioned a place of trust, a community cornerstone where anyone, regardless of their station, could find support. The first deposits weren't in gold bars, but in worn leather pouches filled with hope and sweat.\n\nI remember laying the first stone myself. The air was filled with languages from a dozen different countries, all united in a common purpose. We weren't building a vault; we were building a ladder for our children. For decades, it served that purpose. We gave loans for new businesses, mortgages for first homes, and scholarships for bright minds. The bank was the heart of the neighborhood, its pulse beating in time with the people it served.\n\nBut as the years passed, it grew. The small brick building was replaced by a marble behemoth, its columns reaching for the sky, perhaps forgetting the humble cobblestones it was built upon. The spirit of community, some say, was replaced by cold, hard profit. The friendly tellers who knew your name were replaced by impersonal forms and complex financial instruments. I sometimes walk past it at night, and I wonder if any of that original hope remains trapped inside that impenetrable vault."
                },
                instruction: { en: "Read for pleasure to understand the overall flow and feeling.", es: "Lee por placer para entender el flujo y sentimiento general." },
                question: { en: "What is the general feeling of this story?", es: "¬øCu√°l es el sentimiento general de esta historia?" },
                options: [
                  { en: "Joyful and triumphant", es: "Alegre y triunfante" },
                  { en: "Nostalgic and slightly sad", es: "Nost√°lgico y un poco triste" },
                  { en: "Angry and aggressive", es: "Enojado y agresivo" }
                ],
                correctAnswerIndex: 1
              },
              {
                id: 8,
                strategy: { en: "Summarizing", es: "Resumen" },
                evidence: {
                  type: 'summary',
                  title: { en: "Final Report", es: "Reporte Final" },
                  content: "All evidence has been collected. Review the case and file your conclusive report, Detective."
                },
                instruction: { en: "Review all the facts and choose the best synthesis of the case.", es: "Revisa todos los hechos y elige la mejor s√≠ntesis del caso." },
                question: { en: "Choose the best summary to close the case.", es: "Elige el mejor resumen para cerrar el caso." },
                options: [
                  {
                    en: "A sophisticated and elusive thief, likely motivated by a belief that the bank has wronged the public, bypassed advanced security at the National Bank. The investigation is focused on several high-profile suspects, but the perpetrator's skill and unclear identity makes the case difficult.",
                    es: "Un ladr√≥n sofisticado y escurridizo, probablemente motivado por la creencia de que el banco ha perjudicado al p√∫blico, eludi√≥ la seguridad avanzada del Banco Nacional. La investigaci√≥n se centra en varios sospechosos de alto perfil, pero la habilidad y la identidad poco clara del autor dificultan el caso."
                  },
                  {
                    en: "Suspect #2, Isabella Monet, who is 5'7\", robbed the bank because she was angry at Mr. Abernathy. She left a note to confuse the police about her real motivation, which was to fund her art forgery operation.",
                    es: "La sospechosa #2, Isabella Monet, que mide 5'7\", rob√≥ el banco porque estaba enojada con el Sr. Abernathy. Dej√≥ una nota para confundir a la polic√≠a sobre su verdadera motivaci√≥n, que era financiar su operaci√≥n de falsificaci√≥n de arte."
                  },
                  {
                    en: "A simple robbery occurred at the National Bank, likely by a disgruntled former security guard. The note about 'the people' was a distraction, and the police should focus on employees with knowledge of the old security system.",
                    es: "Ocurri√≥ un robo simple en el Banco Nacional, probablemente por un ex guardia de seguridad descontento. La nota sobre 'la gente' fue una distracci√≥n, y la polic√≠a deber√≠a centrarse en los empleados con conocimiento del antiguo sistema de seguridad."
                  }
                ],
                correctAnswerIndex: 0
              }
            ]
          },
          {
            title: { en: "The Crimson Canary Caper", es: "El Caso del Canario Carmes√≠" },
            imageUrl: "caso 2 imagen1.png",
            levels: [
              {
                id: 1,
                strategy: { en: "Predicting", es: "Predicci√≥n" },
                evidence: { 
                  type: 'image_title', 
                  title: { en: "Case File: 002", es: "Expediente: 002" }, 
                  content: 'Silence at the Blue Note Club',
                  imageUrl: "cantante desaparecida.png"
                },
                instruction: { en: "Look at the image of the empty stage.", es: "Mira la imagen del escenario vac√≠o." },
                question: { en: "What do you think happened here?", es: "¬øQu√© crees que pas√≥ aqu√≠?" },
                options: [{ en: "A star performer has vanished", es: "Un artista estrella ha desaparecido" }, { en: "The club is preparing for a show", es: "El club se prepara para un espect√°culo" }, { en: "The club has permanently closed", es: "El club ha cerrado permanentemente" }],
                correctAnswerIndex: 0
              },
              {
                id: 2,
                strategy: { en: "Skimming", es: "Lectura R√°pida (Skimming)" },
                evidence: {
                  type: 'text',
                  title: { en: "Tabloid Front Page", es: "Portada de Tabloide" },
                  content: [
                    "The city's vibrant nightlife was struck a silent blow last night as star vocalist Lila 'The Canary' Dubois vanished from the renowned Blue Note Club mid-performance. Her disappearance coincided with the theft of her iconic ruby necklace, 'The Crimson Tear,' a piece rumored to be worth millions. The club was immediately placed on lockdown, but a thorough search of the premises revealed no trace of the beloved singer or her priceless jewel.",
                    "Witnesses state that Dubois was in top form during her first set, enthralling the packed house with her signature soulful voice. She retired to her dressing room during a brief intermission, but never returned to the stage. Her manager, the notoriously shrewd Silas Croft, was the one to discover her empty dressing room, showing signs of a hasty departure but no overt struggle.",
                    "Police are investigating several angles, including a kidnapping for ransom, but some sources close to the singer suggest a more complex story. Dubois had recently expressed her frustration with the pressures of fame and her restrictive contract with Mr. Croft. The disappearance is as mysterious as the singer herself, leaving fans and authorities to wonder if she was a victim or the architect of her own vanishing act."
                  ]
                },
                instruction: { en: "Quickly read the first sentence of each paragraph.", es: "Lee r√°pidamente la primera oraci√≥n de cada p√°rrafo." },
                question: { en: "What is the main topic of this news story?", es: "¬øCu√°l es el tema principal de esta noticia?" },
                options: [{ en: "A famous singer and her necklace have disappeared from a nightclub.", es: "Una cantante famosa y su collar han desaparecido de un club nocturno." }, { en: "The Blue Note Club is showcasing a new ruby collection.", es: "El Blue Note Club est√° exhibiendo una nueva colecci√≥n de rub√≠es." }, { en: "Lila Dubois is announcing her retirement from singing.", es: "Lila Dubois anuncia su retiro del canto." }],
                correctAnswerIndex: 0
              },
              {
                id: 3,
                strategy: { en: "Scanning", es: "B√∫squeda de Datos (Scanning)" },
                evidence: {
                  type: 'data_sheet',
                  title: { en: "Club Performance Schedule", es: "Horario de Actuaci√≥n del Club" },
                  content: [
                    { "Time": "19:00", "Act": "Doors Open", "Staff": "Security Team, Hostess" },
                    { "Time": "20:00", "Act": "Opening Act: The Jazz Cats", "Staff": "Bartenders, Waitstaff" },
                    { "Time": "21:00", "Act": "Main Act: Lila Dubois (Set 1)", "Staff": "Spotlight Operator" },
                    { "Time": "21:45", "Act": "Intermission", "Staff": "Stagehand: Rico Velez" },
                    { "Time": "22:00", "Act": "Main Act: Lila Dubois (Set 2)", "Staff": "Spotlight Operator" },
                  ]
                },
                instruction: { en: "Find the requested detail in the schedule.", es: "Encuentra el detalle solicitado en el horario." },
                question: { en: "What is the name of the stagehand on duty during the intermission?", es: "¬øCu√°l es el nombre del tramoyista de turno durante el intermedio?" },
                options: [{ en: "The Jazz Cats", es: "The Jazz Cats" }, { en: "Silas Croft", es: "Silas Croft" }, { en: "Rico Velez", es: "Rico Velez" }],
                correctAnswerIndex: 2
              },
              {
                id: 4,
                strategy: { en: "Contextual Guessing", es: "Adivinanza Contextual" },
                evidence: {
                  type: 'sms',
                  title: { en: "Overheard Conversation", es: "Conversaci√≥n Escuchada" },
                  content: "A bartender told the police: 'Her manager, Mr. Croft, was incredibly avaricious. He was always talking about profit margins and ticket sales, never about Lila's artistry or well-being. He saw her as a product, not a person.'"
                },
                instruction: { en: "Use the surrounding words to guess the meaning.", es: "Usa las palabras de alrededor para adivinar el significado." },
                question: { en: "Based on the context, what does 'avaricious' mean?", es: "Basado en el contexto, ¬øqu√© significa 'avaricious'?" },
                options: [{ en: "Extremely greedy for wealth", es: "Extremadamente codicioso de riqueza" }, { en: "Supportive and kind", es: "Comprensivo y amable" }, { en: "Musically talented", es: "Musicalmente talentoso" }],
                correctAnswerIndex: 0
              },
              {
                id: 5,
                strategy: { en: "Intensive Reading", es: "Lectura Intensiva" },
                evidence: {
                  type: 'legal_text',
                  title: { en: "Insurance Policy Excerpt", es: "Extracto de P√≥liza de Seguro" },
                  content: "The insured item, a ruby necklace designated 'The Crimson Tear,' is under the exclusive care of the policyholder, Mr. Silas Croft. As the designated guardian of the item, he is solely responsible for its security at all times. He must report any loss or damage within 24 hours of the incident."
                },
                instruction: { en: "Analyze the sentence structure carefully.", es: "Analiza la estructura de la oraci√≥n cuidadosamente." },
                question: { en: "In the second sentence, who does the pronoun 'he' refer to?", es: "En la segunda oraci√≥n, ¬øa qui√©n se refiere el pronombre 'he' (√©l)?" },
                options: [{ en: "A police detective", es: "Un detective de polic√≠a" }, { en: "Mr. Silas Croft", es: "Sr. Silas Croft" }, { en: "An insurance agent", es: "Un agente de seguros" }],
                correctAnswerIndex: 1
              },
              {
                id: 6,
                strategy: { en: "Inferring", es: "Inferencia" },
                evidence: {
                  type: 'note',
                  title: { en: "Napkin from Dressing Room", es: "Servilleta del Camerino" },
                  content: "Found in Lila's dressing room, a napkin with a lipstick print and a message: 'Some birds aren't meant to be caged. Their songs are for the world to hear, not for one man's profit.'"
                },
                instruction: { en: "What is the hidden meaning in this note?", es: "¬øCu√°l es el significado oculto en esta nota?" },
                question: { en: "What does the note imply about Lila's disappearance?", es: "¬øQu√© implica la nota sobre la desaparici√≥n de Lila?" },
                options: [{ en: "She was kidnapped by a rival singer.", es: "Fue secuestrada por un cantante rival." }, { en: "She left willingly to escape her manager's control.", es: "Se fue voluntariamente para escapar del control de su m√°nager." }, { en: "She lost the necklace and was afraid to tell her manager.", es: "Perdi√≥ el collar y ten√≠a miedo de dec√≠rselo a su m√°nager." }],
                correctAnswerIndex: 1
              },
              {
                id: 7,
                strategy: { en: "Extensive Reading", es: "Lectura Extensiva" },
                evidence: {
                  type: 'narrative',
                  title: { en: "Fan Magazine Article", es: "Art√≠culo de Revista de Fans" },
                  content: "To her fans, Lila Dubois was more than a singer; she was an inspiration. Her story was one of passion and perseverance. She came from nothing, singing in smoky back-alley bars until a scout discovered her. Her voice was a gift, a pure and powerful instrument that could silence a room and move people to tears. She never forgot where she came from, often speaking about the freedom of music and the joy of sharing her gift. In interviews, she seemed to sparkle, a vibrant soul who lived for her art. But in recent months, a shadow seemed to fall over her. The sparkle in her eyes dimmed, replaced by a weariness that even the stage lights couldn't hide. She spoke less of joy and more of obligations, schedules, and contracts. It was a subtle shift, one only a true fan would notice, but it was there. The canary was still singing, but one had to wonder if she was still enjoying the song."
                },
                instruction: { en: "Read for the overall feeling of the story.", es: "Lee para captar el sentimiento general de la historia." },
                question: { en: "What is the general tone of this article?", es: "¬øCu√°l es el tono general de este art√≠culo?" },
                options: [{ en: "Admiration mixed with recent concern", es: "Admiraci√≥n mezclada con preocupaci√≥n reciente" }, { en: "Purely critical and negative", es: "Puramente cr√≠tico y negativo" }, { en: "Excited and optimistic", es: "Emocionado y optimista" }],
                correctAnswerIndex: 0
              },
              {
                id: 8,
                strategy: { en: "Summarizing", es: "Resumen" },
                evidence: {
                  type: 'summary',
                  title: { en: "Closing Statement", es: "Declaraci√≥n Final" },
                  content: "All clues have been gathered. It's time to close the file on the Crimson Canary."
                },
                instruction: { en: "Choose the best summary of the case.", es: "Elige el mejor resumen del caso." },
                question: { en: "Which statement best summarizes the investigation?", es: "¬øQu√© declaraci√≥n resume mejor la investigaci√≥n?" },
                options: [
                  { en: "Lila Dubois was likely kidnapped for her valuable necklace by a professional thief who knew the club's schedule.", es: "Lila Dubois fue probablemente secuestrada por su valioso collar por un ladr√≥n profesional que conoc√≠a el horario del club." },
                  { en: "Feeling trapped and exploited by her greedy manager, Lila Dubois likely staged her own disappearance to regain her freedom, leaving a cryptic note as a clue to her true intentions.", es: "Sinti√©ndose atrapada y explotada por su avaro m√°nager, Lila Dubois probablemente organiz√≥ su propia desaparici√≥n para recuperar su libertad, dejando una nota cr√≠ptica como pista de sus verdaderas intenciones." },
                  { en: "Stagehand Rico Velez, seeking to get rich quick, stole the necklace during the intermission and is now hiding the singer.", es: "El tramoyista Rico Velez, buscando enriquecerse r√°pidamente, rob√≥ el collar durante el intermedio y ahora esconde a la cantante." }
                ],
                correctAnswerIndex: 1
              }
            ]
          }
        ];
        
        const MAX_PLAYS = CASES.length;

        // --- COMPONENTS ---

        const formatTime = (seconds) => {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes}:${remainingSeconds < 10 ? '0' : ''}${remainingSeconds}`;
        };

        const Header = ({ lives, timeLeft, language, toggleLanguage, translations }) => (
            <header className="sticky top-0 z-50 w-full bg-noir-bg/95 backdrop-blur shadow-md border-b-2 border-noir-accent/50 p-4 flex justify-between items-center text-noir-paper font-display text-lg md:text-xl">
                <div className="flex items-center space-x-4">
                    <div>{translations.lives}: {'‚ù§Ô∏è'.repeat(lives)}<span className="text-noir-bg/50">{'‚ù§Ô∏è'.repeat(TOTAL_LIVES - lives)}</span></div>
                    <div>{translations.time}: {formatTime(timeLeft)}</div>
                </div>
                <button onClick={toggleLanguage} className="text-sm md:text-base border-2 border-noir-paper/50 px-2 py-1 rounded hover:bg-noir-paper hover:text-noir-bg transition-colors duration-200">
                    {translations.toggle_language}
                </button>
            </header>
        );

        const InstructionScreen = ({ onStart, translations }) => {
            return (
                <div className="min-h-screen flex items-center justify-center p-4 md:p-8">
                    <div className="bg-noir-paper text-noir-text max-w-4xl w-full p-8 md:p-12 shadow-2xl relative border-4 border-noir-text/80 overflow-hidden transform rotate-0 md:rotate-1">
                        {/* Stamp Effect */}
                        <div className="absolute top-4 right-4 border-4 border-noir-red text-noir-red p-2 font-display text-xl md:text-2xl opacity-70 transform rotate-12">
                            CONFIDENTIAL
                        </div>

                        <div className="h-full overflow-y-auto max-h-[80vh] pr-4 custom-scrollbar">
                            <h1 className="font-display text-4xl md:text-5xl mb-6 text-center border-b-4 border-noir-text/80 pb-4">
                                Manual de Operaciones: <br/>Detective Archives
                            </h1>

                            <div className="font-body space-y-6 text-lg">
                                <section>
                                    <h2 className="font-display text-2xl mb-2 bg-noir-text text-noir-paper inline-block px-2">Misi√≥n</h2>
                                    <p>Eres un detective de √©lite. Para ganar el juego ("Detective Archives"), debes resolver <span className="font-bold">DOS</span> casos criminales consecutivos.</p>
                                </section>

                                <section>
                                    <h2 className="font-display text-2xl mb-2 bg-noir-text text-noir-paper inline-block px-2">1. Estructura del Juego (La Doble Jornada)</h2>
                                    <p>El juego se divide en dos expedientes distintos. Al terminar el primero, el sistema te ofrece la opci√≥n de seguir con el segundo.</p>
                                    <ul className="list-disc pl-5 mt-2 space-y-1">
                                        <li><strong>Caso 1:</strong> The Midnight Heist (El robo al Banco Nacional).</li>
                                        <li><strong>Caso 2:</strong> The Crimson Canary Caper (La desaparici√≥n de la cantante y el rub√≠).</li>
                                    </ul>
                                </section>

                                <section>
                                    <h2 className="font-display text-2xl mb-2 bg-noir-text text-noir-paper inline-block px-2">2. Configuraci√≥n del Tablero</h2>
                                    <ul className="list-disc pl-5 space-y-1">
                                        <li><strong>Tiempo (Time ‚è±Ô∏è):</strong> Tienes 04:00 minutos para resolver cada caso.</li>
                                        <li><strong>Vidas (Lives ‚ù§Ô∏è):</strong> Tienes 3 corazones.</li>
                                        <li><strong>Idioma (üá¨üáß/üá™üá∏):</strong> Bot√≥n superior derecho. √ösalo para traducir preguntas, pero recuerda: la evidencia siempre est√° en ingl√©s.</li>
                                    </ul>
                                </section>

                                <section>
                                    <h2 className="font-display text-2xl mb-2 bg-noir-text text-noir-paper inline-block px-2">3. Flujo de la Investigaci√≥n</h2>
                                    <div className="ml-2 border-l-2 border-noir-text/30 pl-4 mt-2">
                                        <h3 className="font-display text-xl underline">El Primer Caso</h3>
                                        <ol className="list-decimal pl-5 space-y-1 mt-1">
                                            <li><strong>Inicio:</strong> Presiona "Start Investigation".</li>
                                            <li><strong>Niveles 1-8:</strong> Debes superar las 8 pruebas de lectura (Predicting, Skimming, Scanning, etc.).
                                                <ul className="list-disc pl-5 text-sm italic">
                                                    <li>Si fallas y pierdes tus vidas: Game Over.</li>
                                                </ul>
                                            </li>
                                            <li><strong>Cierre:</strong> Si respondes correctamente el Nivel 8, ver√°s "Case Closed".</li>
                                            <li><strong>Siguiente:</strong> Pulsa "Next Case" para continuar.</li>
                                        </ol>
                                    </div>
                                    <div className="ml-2 border-l-2 border-noir-text/30 pl-4 mt-4">
                                        <h3 className="font-display text-xl underline">El Segundo Caso</h3>
                                        <p className="mt-1">Nueva escena en el "Blue Note Club". Enfrentar√°s 8 nuevas preguntas y una historia diferente. ¬°La dificultad puede variar!</p>
                                    </div>
                                </section>

                                <section>
                                    <h2 className="font-display text-2xl mb-2 bg-noir-text text-noir-paper inline-block px-2">4. Instrucciones por Tipo de Nivel</h2>
                                    <p>En ambos casos, enfrentar√°s la misma secuencia l√≥gica:</p>
                                    <ol className="list-decimal pl-5 grid md:grid-cols-2 gap-2 mt-2 text-base">
                                        <li><strong>Predicting:</strong> Adivina el tema por la portada.</li>
                                        <li><strong>Skimming:</strong> Lee t√≠tulos y primeras l√≠neas.</li>
                                        <li><strong>Scanning:</strong> Busca un dato exacto.</li>
                                        <li><strong>Contextual Guessing:</strong> Adivina palabras por contexto.</li>
                                        <li><strong>Intensive Reading:</strong> Analiza gram√°tica o detalles.</li>
                                        <li><strong>Inferring:</strong> Deduce motivos ocultos.</li>
                                        <li><strong>Extensive Reading:</strong> Entiende la trama general.</li>
                                        <li><strong>Summarizing:</strong> Elige el mejor resumen.</li>
                                    </ol>
                                </section>

                                 <section>
                                    <h2 className="font-display text-2xl mb-2 bg-noir-text text-noir-paper inline-block px-2">5. Victoria y Derrota</h2>
                                     <ul className="list-disc pl-5 space-y-1">
                                        <li><strong>Victoria Total:</strong> Resuelve AMBOS casos para ver la pantalla "All Cases Solved".</li>
                                        <li><strong>Error:</strong> Pierdes 1 vida. Si pierdes las 3, el juego termina.</li>
                                    </ul>
                                </section>
                            </div>

                            <div className="mt-8 text-center">
                                 <button 
                                    onClick={onStart} 
                                    className="font-display text-2xl bg-noir-text text-noir-paper px-8 py-3 rounded-sm shadow-lg hover:bg-noir-accent hover:text-noir-text transition-all duration-300 transform hover:scale-105 border-2 border-transparent"
                                >
                                    {translations.accept_mission}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const StartScreen = ({ onStart, translations, caseTitle, imageUrl }) => (
            <div className="flex flex-col items-center justify-center h-screen text-center text-noir-paper p-4">
                <h1 className="font-display text-5xl md:text-7xl text-noir-accent mb-2">{translations.title}</h1>
                <p className="font-display text-2xl md:text-4xl mt-2 mb-8">{caseTitle}</p>
                <div className="w-full max-w-lg mx-auto border-4 border-noir-paper/50 mb-8 shadow-lg">
                    <img src={imageUrl} alt={caseTitle} className="w-full h-64 object-cover" />
                </div>
                <button onClick={onStart} className="font-display text-2xl bg-noir-accent text-noir-bg px-8 py-3 rounded-lg shadow-lg hover:bg-yellow-300 transition-all duration-300 transform hover:scale-105">
                    {translations.start_button}
                </button>
            </div>
        );

        const EndScreen = ({ onNextCase, onRestartFromBeginning, won, reason, translations, playCount }) => {
            const message = won 
                ? translations.win_message
                : reason === 'time'
                    ? translations.lose_message_time
                    : translations.lose_message_lives;

            const isLastCase = playCount >= MAX_PLAYS;

            let button = null;

            if (won) {
                const buttonText = isLastCase ? translations.finish_investigation : translations.play_again;
                button = (
                    <button onClick={onNextCase} className="font-display text-2xl bg-noir-paper text-noir-bg px-8 py-3 rounded-lg shadow-lg hover:bg-gray-300 transition-all duration-300 transform hover:scale-105">
                        {buttonText}
                    </button>
                );
            } else { // Lost
                button = (
                    <button onClick={onRestartFromBeginning} className="font-display text-2xl bg-noir-paper text-noir-bg px-8 py-3 rounded-lg shadow-lg hover:bg-gray-300 transition-all duration-300 transform hover:scale-105">
                        {translations.return_to_start}
                    </button>
                );
            }

            return (
                <div className="flex flex-col items-center justify-center h-screen text-center text-noir-paper p-4">
                    <h1 className={`font-display text-5xl md:text-7xl ${won ? 'text-noir-accent' : 'text-noir-red'}`}>
                        {won ? translations.case_closed_win : translations.case_closed_lose}
                    </h1>
                    <p className="font-body text-xl md:text-2xl mt-4 mb-12 max-w-2xl">{message}</p>
                    {button}
                </div>
            );
        };
        
        const GameOverScreen = ({ translations, onRestart }) => (
            <div className="flex flex-col items-center justify-center h-screen text-center text-noir-paper p-4">
                <h1 className="font-display text-5xl md:text-7xl text-noir-accent">{translations.all_cases_solved}</h1>
                <p className="font-body text-xl md:text-2xl mt-4 mb-8 max-w-2xl">{translations.final_message}</p>
                <div className="w-full max-w-md mx-auto mb-8 border-4 border-noir-paper/30">
                    <img src="final.png" alt="Fin" className="w-full h-auto" />
                </div>
                <button onClick={onRestart} className="font-display text-2xl bg-noir-paper text-noir-bg px-8 py-3 rounded-lg shadow-lg hover:bg-gray-300 transition-all duration-300 transform hover:scale-105">
                    {translations.return_to_start}
                </button>
            </div>
        );

        const EvidenceRenderer = ({ evidence, language }) => {
          const renderContent = () => {
            switch (evidence.type) {
              case 'image_title':
                return (
                  <div className="text-center">
                    <div className="w-full max-w-lg mx-auto border-4 border-noir-text/50 mb-4 bg-noir-text">
                        {evidence.imageUrl ? (
                           <img src={evidence.imageUrl} alt={evidence.content} className="w-full h-64 object-cover" />
                        ) : (
                           <div className="h-64 flex items-center justify-center">
                             <p className="text-noir-paper/50 font-display text-2xl"> [Image Evidence] </p>
                           </div>
                        )}
                    </div>
                    <h3 className="font-display text-3xl">{evidence.content}</h3>
                  </div>
                );
              case 'text':
                return (
                  <div className="space-y-4">
                    {evidence.content.map((p, i) => <p key={i} className="text-justify indent-8 leading-relaxed">{p}</p>)}
                  </div>
                );
              case 'data_sheet':
                return (
                  <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-4 text-sm md:text-base">
                    {evidence.content.map((item, i) => (
                      <div key={i} className="border border-noir-text/30 p-3 bg-noir-paper/90">
                        {Object.entries(item).map(([key, value]) => (
                          <p key={key}><span className="font-bold">{key}:</span> {value}</p>
                        ))}
                      </div>
                    ))}
                  </div>
                );
              case 'sms':
              case 'note':
              case 'legal_text':
              case 'narrative':
                const text = evidence.content;
                const highlightWord = evidence.type === 'sms' ? text.match(/\b\w*elusive\w*\b|\b\w*avaricious\w*\b|\b\w*hubris\w*\b/i)?.[0] : null;
                const highlighted = highlightWord ? text.replace(highlightWord, `<span class="bg-noir-accent text-noir-bg px-1">${highlightWord}</span>`) : text;
                return <div className="text-xl italic text-center p-4 border border-dashed border-noir-text/50 whitespace-pre-line" dangerouslySetInnerHTML={{ __html: highlighted }}></div>;
              case 'summary':
                return <p className="text-lg italic text-center p-4">{evidence.content}</p>
              default:
                return null;
            }
          }

          return (
            <div className="bg-noir-paper text-noir-text p-6 my-6 shadow-lg rounded-sm w-full font-body">
              <h2 className="font-display text-2xl border-b-2 border-noir-text/30 pb-2 mb-4">{evidence.title?.[language]}</h2>
              {renderContent()}
            </div>
          )
        };

        const LevelView = ({ level, language, onAnswer, translations }) => {
            return (
                <div className="w-full max-w-5xl mx-auto p-4 md:p-8 flex flex-col items-center">
                    <div className="w-full text-center mb-6">
                        <h1 className="font-display text-3xl md:text-4xl text-noir-accent">{`${translations.level} ${level.id}: ${level.strategy[language]}`}</h1>
                        <p className="font-body text-lg md:text-xl text-noir-paper/80 mt-2">{level.instruction[language]}</p>
                    </div>
                    
                    <EvidenceRenderer evidence={level.evidence} language={language} />

                    <div className="w-full bg-noir-bg/50 p-6 rounded-md mt-6 border border-noir-paper/20">
                      <h3 className="font-display text-2xl text-noir-paper mb-4 text-center">{level.question[language]}</h3>
                      <div className="grid grid-cols-1 md:grid-cols-1 gap-4">
                          {level.options.map((option, index) => (
                              <button 
                                  key={index} 
                                  onClick={() => onAnswer(index)} 
                                  className="w-full text-left font-body text-lg bg-noir-paper text-noir-text p-4 rounded-sm border-2 border-transparent hover:border-noir-accent hover:bg-yellow-50 transition-all duration-200"
                              >
                                  {option[language]}
                              </button>
                          ))}
                      </div>
                    </div>
                </div>
            );
        };

        const FeedbackModal = ({ isCorrect, onNext, translations, level, language }) => {
            const title = isCorrect ? translations.correct : translations.incorrect;
            const buttonText = translations.next_level;
            const bgColor = isCorrect ? 'bg-noir-green' : 'bg-noir-red';
            const correctAnswerText = level.options[level.correctAnswerIndex][language];
            const message = isCorrect ? null : `${translations.correct_answer_was} "${correctAnswerText}"`;

            return (
                <div className="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4 backdrop-blur-sm">
                    <div className={`p-8 rounded-lg shadow-2xl text-center font-display ${bgColor} text-noir-paper w-full max-w-lg border-2 border-noir-paper/50`}>
                        <h2 className="text-4xl md:text-5xl mb-4">{title}</h2>
                        {message && <p className="font-body text-xl mb-6 bg-black/20 p-2 rounded">{message}</p>}
                        <button onClick={onNext} className="text-2xl bg-noir-paper text-noir-bg px-8 py-3 rounded-lg shadow-lg hover:bg-gray-300 transition-all duration-300 transform hover:scale-105">
                            {buttonText}
                        </button>
                    </div>
                </div>
            );
        };

        // --- MAIN APP COMPONENT ---

        function App() {
            // 'manual' is the new initial state for showing instructions
            const [gameState, setGameState] = useState('manual');
            const [currentLevelIndex, setCurrentLevelIndex] = useState(0);
            const [lives, setLives] = useState(TOTAL_LIVES);
            const [timeLeft, setTimeLeft] = useState(TOTAL_TIME);
            const [language, setLanguage] = useState('en');
            const [lastAnswerCorrect, setLastAnswerCorrect] = useState(false);
            const [endReason, setEndReason] = useState('win');
            const [caseIndex, setCaseIndex] = useState(0);
            const [playCount, setPlayCount] = useState(1);

            const translations = useMemo(() => TRANSLATIONS[language], [language]);
            const currentCase = useMemo(() => CASES[caseIndex], [caseIndex]);
            
            useEffect(() => {
                if (gameState !== 'playing') return;

                if (timeLeft <= 0) {
                    setGameState('lost');
                    setEndReason('time');
                    return;
                }

                const timer = setInterval(() => {
                    setTimeLeft(prevTime => prevTime - 1);
                }, 1000);

                return () => clearInterval(timer);
            }, [gameState, timeLeft]);

            const resetGame = useCallback(() => {
                if (playCount >= MAX_PLAYS) {
                  setGameState('gameOver');
                  return;
                }
                setPlayCount(prev => prev + 1);
                setCaseIndex(prev => (prev + 1) % CASES.length);
                setGameState('start');
                setCurrentLevelIndex(0);
                setLives(TOTAL_LIVES);
                // NOTE: We do NOT reset timeLeft here. It is shared across cases.
            }, [playCount]);

            const handleRestartFromBeginning = useCallback(() => {
                setPlayCount(1);
                setCaseIndex(0);
                setCurrentLevelIndex(0);
                setLives(TOTAL_LIVES);
                setTimeLeft(TOTAL_TIME); // Only reset time when fully restarting
                setGameState('manual'); // Go back to instructions
            }, []);

            const handleInstructionAccept = () => {
                setGameState('start');
            };

            const handleStart = () => {
                setGameState('playing');
            };

            const toggleLanguage = useCallback(() => {
                setLanguage(prev => prev === 'en' ? 'es' : 'en');
            }, []);

            const handleAnswer = useCallback((selectedIndex) => {
                const isCorrect = currentCase.levels[currentLevelIndex].correctAnswerIndex === selectedIndex;
                setLastAnswerCorrect(isCorrect);
                
                if (!isCorrect) {
                    const newLives = lives - 1;
                    setLives(newLives);
                    if (newLives <= 0) {
                        setGameState('lost');
                        setEndReason('lives');
                        return;
                    }
                }
                setGameState('feedback');
            }, [currentLevelIndex, lives, currentCase]);
            
            const handleFeedbackContinue = () => {
                if (currentLevelIndex + 1 >= currentCase.levels.length) {
                    setGameState('won');
                    setEndReason('win');
                } else {
                    setCurrentLevelIndex(prev => prev + 1);
                    setGameState('playing');
                }
            };

            const renderContent = () => {
                const currentLevel = currentCase.levels[currentLevelIndex];
                switch (gameState) {
                    case 'manual':
                        return <InstructionScreen onStart={handleInstructionAccept} translations={translations} />;
                    case 'start':
                        return <StartScreen onStart={handleStart} translations={translations} caseTitle={currentCase.title[language]} imageUrl={currentCase.imageUrl} />;
                    case 'playing':
                        return (
                            <main className="flex-grow flex flex-col items-center w-full">
                                <LevelView 
                                    level={currentLevel} 
                                    language={language}
                                    onAnswer={handleAnswer} 
                                    translations={translations}
                                />
                            </main>
                        );
                    case 'feedback':
                        return (
                            <>
                                <main className="flex-grow flex flex-col items-center w-full opacity-30 pointer-events-none">
                                    <LevelView
                                        level={currentLevel}
                                        language={language}
                                        onAnswer={() => {}} 
                                        translations={translations}
                                    />
                                </main>
                                <FeedbackModal 
                                    isCorrect={lastAnswerCorrect} 
                                    onNext={handleFeedbackContinue}
                                    translations={translations}
                                    level={currentLevel}
                                    language={language}
                                />
                            </>
                        );
                    case 'won':
                        return <EndScreen onNextCase={resetGame} onRestartFromBeginning={handleRestartFromBeginning} won={true} reason={endReason} translations={translations} playCount={playCount} />;
                    case 'lost':
                        return <EndScreen onNextCase={resetGame} onRestartFromBeginning={handleRestartFromBeginning} won={false} reason={endReason} translations={translations} playCount={playCount} />;
                    case 'gameOver':
                        return <GameOverScreen translations={translations} onRestart={handleRestartFromBeginning} />;
                }
            };

            return (
                <div className="bg-noir-bg min-h-screen flex flex-col">
                    { (gameState === 'playing' || gameState === 'feedback') && 
                        <Header 
                            lives={lives} 
                            timeLeft={timeLeft} 
                            language={language}
                            toggleLanguage={toggleLanguage}
                            translations={translations}
                        /> 
                    }
                    {renderContent()}
                </div>
            );
        }

        const rootElement = document.getElementById('root');
        const root = ReactDOM.createRoot(rootElement);
        root.render(<App />);

    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>